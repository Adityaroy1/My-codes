<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Dietician & Meal Planner</title>
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #2ecc71; /* Fresh Green */
            --primary-dark: #27ae60;
            --glass-bg: rgba(255, 255, 255, 0.95);
            --text-dark: #2c3e50;
            --text-light: #7f8c8d;
            --shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            /* Healthy Food Background Image */
            background: url('https://images.unsplash.com/photo-1490818387583-1baba5e638af?q=80&w=1932&auto=format&fit=crop') no-repeat center center fixed;
            background-size: cover;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-dark);
        }

        /* Overlay to ensure text readability */
        body::before {
            content: "";
            position: fixed; /* Fixed to cover full scrollable area/viewport */
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: -1;
        }

        .app-container {
            width: 100%;
            max-width: 900px;
            margin: 20px;
            position: relative;
            overflow: hidden;
            border-radius: 16px;
            box-shadow: var(--shadow);
            background: transparent;
        }

        /* --- Window/View System --- */
        .view {
            background: var(--glass-bg);
            padding: 40px;
            border-radius: 16px;
            transition: all 0.4s ease-in-out;
            animation: fadeIn 0.5s ease;
        }

        .hidden {
            display: none;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1, h2, h3 { color: var(--primary-dark); margin-top: 0; }
        
        h1 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 30px;
            border-bottom: 3px solid var(--primary);
            display: inline-block;
            padding-bottom: 10px;
        }

        /* --- Start Page Styling --- */
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .info-item {
            background: rgba(236, 240, 241, 0.5);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid var(--primary);
        }

        .info-item h3 { font-size: 1.2rem; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }
        .info-item p { font-size: 0.95rem; color: #555; line-height: 1.6; margin: 0; }

        .feature-list {
            list-style: none;
            padding: 0;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 10px;
        }

        .feature-list li {
            font-size: 1.05rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* --- Form Styling --- */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-group {
            margin-bottom: 20px;
            position: relative;
        }

        .full-width { grid-column: span 2; }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-dark);
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
            box-sizing: border-box;
        }

        input:focus, select:focus {
            border-color: var(--primary);
            outline: none;
        }

        /* --- Info Tooltip (i) --- */
        .info-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            background-color: var(--primary);
            color: white;
            border-radius: 50%;
            font-size: 12px;
            margin-left: 8px; /* Default margin */
            cursor: help;
            position: relative;
            font-family: serif;
            font-weight: bold;
        }
        
        /* Specific offset for the BMI icon, moving it 14px right to ensure popup visibility */
        .bmi-icon-offset {
            margin-left: 14px;
        }

        /* Tooltip Text (Centered) */
        .info-icon:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%); 
            background-color: #333;
            color: #fff;
            padding: 10px;
            border-radius: 6px;
            font-size: 12px;
            font-family: sans-serif;
            width: 250px;
            z-index: 100;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            line-height: 1.4;
        }

        /* Tooltip Arrow (Centered) */
        .info-icon:hover::before {
            content: "";
            position: absolute;
            bottom: 105%;
            left: 50%;
            margin-left: -5px; 
            border-width: 5px;
            border-style: solid;
            border-color: transparent transparent transparent transparent;
            border-top-color: #333;
        }

        /* --- Buttons --- */
        .btn {
            display: block;
            width: 100%;
            padding: 15px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s, transform 0.2s;
            margin-top: 20px;
            text-align: center;
        }

        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #95a5a6;
            margin-top: 0;
            margin-bottom: 20px;
            width: auto;
            display: inline-block;
            padding: 10px 20px;
            font-size: 14px;
        }
        
        .btn-secondary:hover { background: #7f8c8d; }

        /* --- Results Grid --- */
        .results-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .result-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border-left: 5px solid var(--primary);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .result-card h3 { margin-bottom: 10px; font-size: 1.1rem; }
        .result-value { font-size: 1.8rem; font-weight: bold; color: var(--primary-dark); }
        .result-sub { font-size: 0.9rem; color: var(--text-light); }

        /* --- Meal Plan Section --- */
        .meal-plan-container {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin-top: 20px;
        }

        .meal-row {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }
        
        .meal-row:last-child { border-bottom: none; }
        
        .meal-time { font-weight: bold; width: 20%; color: var(--primary-dark); }
        .meal-desc { width: 60%; }
        .meal-cal { width: 20%; text-align: right; color: var(--text-light); }

        /* Mobile Responsiveness */
        @media (max-width: 600px) {
            .form-grid { grid-template-columns: 1fr; }
            .full-width { grid-column: span 1; }
            .info-grid { grid-template-columns: 1fr; }
            .feature-list { grid-template-columns: 1fr; }
            .meal-row { flex-direction: column; }
            .meal-time, .meal-desc, .meal-cal { width: 100%; margin-bottom: 5px; text-align: left; }
        }
    </style>
</head>
<body onload="switchView('start')">

<div class="app-container">
    
    <!-- === WINDOW 0: START PAGE === -->
    <div id="start-view" class="view">
        <div style="text-align: center;">
            <h1><i class="fas fa-apple-alt"></i> Welcome to AI Dietician Pro</h1>
            <p style="font-size: 1.2rem; line-height: 1.6; margin-bottom: 30px; color: #555;">
                Your intelligent health assistant. We analyze your unique biometrics to create a scientific, personalized nutrition plan.
            </p>
        </div>

        <div class="info-grid">
            <div class="info-item">
                <h3><i class="fas fa-user-md" style="color:var(--primary)"></i> What does a Dietician do?</h3>
                <p>A dietician is an expert in dietetics—human nutrition and the regulation of diet. They assess your health needs and formulate personalized meal plans to help you achieve goals like weight loss, muscle gain, or maintenance.</p>
            </div>
            <div class="info-item">
                <h3><i class="fas fa-robot" style="color:var(--primary)"></i> Why use AI Dietician?</h3>
                <p>We use gold-standard medical algorithms (Mifflin-St Jeor) to instantly calculate your metabolic rate and macronutrients with mathematical precision, completely free and available 24/7.</p>
            </div>
        </div>
        
        <h3 style="margin-top: 25px; border-bottom: 2px solid #eee; padding-bottom: 10px;">Key Advantages:</h3>
        <ul class="feature-list">
            <li><i class="fas fa-check-circle" style="color:var(--primary)"></i> Personalized Calorie Targets</li>
            <li><i class="fas fa-check-circle" style="color:var(--primary)"></i> Accurate BMI & BMR Analysis</li>
            <li><i class="fas fa-check-circle" style="color:var(--primary)"></i> Custom Macro-Nutrient Splits</li>
            <li><i class="fas fa-check-circle" style="color:var(--primary)"></i> Tailored Meal Suggestions</li>
            <li><i class="fas fa-check-circle" style="color:var(--primary)"></i> Hydration & Activity Guides</li>
            <li><i class="fas fa-check-circle" style="color:var(--primary)"></i> Adaptable to Vegan/Veg Diets</li>
        </ul>

        <button class="btn" onclick="switchView('input')" style="margin-top: 40px; font-size: 1.3rem;">Generate My Plan <i class="fas fa-arrow-right"></i></button>
    </div>

    <!-- === WINDOW 1: INPUT FORM === -->
    <div id="input-view" class="view hidden">
        <div style="text-align: center;">
            <button class="btn btn-secondary" onclick="switchView('start')" style="float:left; width:auto; margin:0;"><i class="fas fa-home"></i> Home</button>
            <h1 style="margin-bottom: 10px; margin-top:0;"><i class="fas fa-leaf"></i> Your Details</h1>
            <p style="margin-bottom: 30px;">Enter your stats for a precise calculation.</p>
        </div>

        <div class="form-grid">
            <!-- Name -->
            <div class="form-group full-width">
                <label>Full Name</label>
                <input type="text" id="name" placeholder="Ex: Sarah Connor">
            </div>

            <!-- Age & Gender -->
            <div class="form-group">
                <label>Age</label>
                <input type="number" id="age" placeholder="Years">
            </div>
            <div class="form-group">
                <label>Gender <span class="info-icon" data-tooltip="Biological sex is used to determine BMR (metabolic rate) as muscle mass distribution differs significantly.">i</span></label>
                <select id="gender">
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                </select>
            </div>

            <!-- Weight -->
            <div class="form-group">
                <label>Weight</label>
                <div style="display: flex; gap: 10px;">
                    <input type="number" id="weight" placeholder="0" style="flex:2">
                    <select id="weight-unit" style="flex:1">
                        <option value="kg">kg</option>
                        <option value="lbs">lbs</option>
                    </select>
                </div>
            </div>

            <!-- Height -->
            <div class="form-group">
                <label>Height</label>
                <div style="display: flex; gap: 10px;">
                    <input type="number" id="height" placeholder="0" style="flex:2">
                    <select id="height-unit" style="flex:1">
                        <option value="cm">cm</option>
                        <option value="ft">feet</option>
                    </select>
                </div>
            </div>

            <!-- Activity Level (Updated) -->
            <div class="form-group full-width">
                <label>Activity Level <span class="info-icon" data-tooltip="This multiplier estimates TDEE (Total Daily Energy Expenditure). Be honest for accurate results!">i</span></label>
                <select id="activity">
                    <option value="1.2">Sedentary (Office job, little exercise)</option>
                    <option value="1.375">Lightly Active (Exercise 1-3 days/week)</option>
                    <option value="1.55">Moderately Active (Exercise 3-5 days/week)</option>
                    <option value="1.725">Very Active (Heavy exercise 6-7 days/week)</option>
                    <option value="1.9">Athlete / Intense Training (2x per day or very physical job)</option>
                </select>
            </div>
            
            <!-- Diet Preference -->
            <div class="form-group full-width">
                <label>Diet Preference</label>
                <select id="diet-preference">
                    <option value="non-vegetarian">Non-Vegetarian</option>
                    <option value="vegetarian">Vegetarian</option>
                    <option value="vegan">Vegan</option>
                </select>
            </div>

            <!-- Goal -->
            <div class="form-group full-width">
                <label>Health Goal</label>
                <select id="goal">
                    <option value="loss">Lose Fat (Healthy Weight Loss)</option>
                    <option value="maintain">Maintain Current Weight</option>
                    <option value="gain">Build Muscle / Gain Weight</option>
                </select>
            </div>
        </div>

        <button class="btn" onclick="calculateAndSwitch()">Generate Analysis <i class="fas fa-magic"></i></button>
    </div>

    <!-- === WINDOW 2: RESULTS REPORT === -->
    <div id="result-view" class="view hidden">
        <button class="btn btn-secondary" onclick="switchView('input')"><i class="fas fa-arrow-left"></i> Edit Data</button>
        
        <h2><i class="fas fa-file-medical-alt"></i> Health Report: <span id="res-name-display" style="color:var(--primary-dark)"></span></h2>

        <!-- Dashboard Cards -->
        <div class="results-dashboard">
            <!-- BMI Card -->
            <div class="result-card">
                <h3>BMI <span class="info-icon bmi-icon-offset" data-tooltip="Body Mass Index: A simple screening tool to categorize body weight status. Formula: kg / m²">i</span></h3>
                <div class="result-value" id="res-bmi">--</div>
                <div class="result-sub" id="res-category">--</div>
            </div>

            <!-- Calories Card -->
            <div class="result-card">
                <h3>Daily Calories <span class="info-icon" data-tooltip="The recommended daily intake to reach your specific goal based on TDEE + Goal Adjustment.">i</span></h3>
                <div class="result-value" id="res-calories">--</div>
                <div class="result-sub">Kcal / Day</div>
            </div>

            <!-- Protein Card -->
            <div class="result-card">
                <h3>Protein Needs <span class="info-icon" data-tooltip="Essential for muscle repair. Calculated based on activity level and goal intensity.">i</span></h3>
                <div class="result-value" id="res-protein">--</div>
                <div class="result-sub">Grams / Day</div>
            </div>

            <!-- Water Card -->
            <div class="result-card">
                <h3>Hydration <span class="info-icon" data-tooltip="Estimated water need. Formula: Weight(kg) / 30.">i</span></h3>
                <div class="result-value" id="res-water">--</div>
                <div class="result-sub">Liters / Day</div>
            </div>
        </div>

        <!-- AI Recommendations -->
        <div class="result-card" style="margin-bottom: 20px; border-left-color: #f39c12;">
            <h3><i class="fas fa-heartbeat"></i> AI Physical Activity Recommendation</h3>
            <p id="res-activity-rec" style="font-size: 1.1rem; line-height: 1.5;">--</p>
        </div>

        <!-- Meal Plan Generator -->
        <div class="meal-plan-container">
            <h3><i class="fas fa-utensils"></i> Suggested Daily Meal Plan</h3>
            <p style="color:#666; font-size: 0.9rem; margin-bottom:15px;">Based on your caloric needs, here is an optimized macro-split structure.</p>
            
            <div id="meal-plan-output">
                <!-- Javascript will populate this -->
            </div>
        </div>
    </div>

</div>

<script>
    // --- Application Logic ---

    // Set the initial view on load
    document.addEventListener('DOMContentLoaded', () => {
        switchView('start');
    });

    // 1. Navigation Controller
    function switchView(viewName) {
        // Hide all views
        document.querySelectorAll('.view').forEach(el => el.classList.add('hidden'));

        // Show target view
        if (viewName === 'start') {
            document.getElementById('start-view').classList.remove('hidden');
        } else if (viewName === 'input') {
            document.getElementById('input-view').classList.remove('hidden');
        } else if (viewName === 'result') {
            document.getElementById('result-view').classList.remove('hidden');
        }
        
        // Scroll to top
        window.scrollTo(0, 0);
    }

    // 2. Main Calculation Function
    function calculateAndSwitch() {
        // Validation
        const name = document.getElementById('name').value;
        const age = document.getElementById('age').value;
        const weight = document.getElementById('weight').value;
        const height = document.getElementById('height').value;

        if (!name || !age || !weight || !height) {
            alert("Please fill in all fields correctly.");
            return;
        }

        // --- Data Normalization ---
        const gender = document.getElementById('gender').value;
        const wUnit = document.getElementById('weight-unit').value;
        const hUnit = document.getElementById('height-unit').value;
        const activity = parseFloat(document.getElementById('activity').value);
        const goal = document.getElementById('goal').value;
        const dietPreference = document.getElementById('diet-preference').value; 

        // Convert to Metric (Kg & Cm)
        let weightKg = (wUnit === 'lbs') ? weight / 2.20462 : parseFloat(weight);
        let heightCm = (hUnit === 'ft') ? height * 30.48 : parseFloat(height);
        let heightM = heightCm / 100;

        // --- Core Calculations ---
        
        // 1. BMI
        let bmi = (weightKg / (heightM * heightM)).toFixed(1);
        let bmiCategory = "";
        if (bmi < 18.5) bmiCategory = "Underweight";
        else if (bmi < 24.9) bmiCategory = "Healthy Weight";
        else if (bmi < 29.9) bmiCategory = "Overweight";
        else bmiCategory = "Obese";

        // 2. BMR (Mifflin-St Jeor)
        let bmr = 0;
        if (gender === 'male') {
            bmr = (10 * weightKg) + (6.25 * heightCm) - (5 * age) + 5;
        } else {
            bmr = (10 * weightKg) + (6.25 * heightCm) - (5 * age) - 161;
        }

        // 3. TDEE & Goal Calories
        let tdee = bmr * activity;
        let targetCalories = 0;
        let adviceText = "";

        if (goal === 'loss') {
            targetCalories = tdee - 500;
            adviceText = "Prioritize High Intensity Interval Training (HIIT) 2x week and steady cardio (walking) daily. Focus on volume eating (vegetables) to stay full.";
        } else if (goal === 'gain') {
            targetCalories = tdee + 400;
            adviceText = "Focus on Hypertrophy training (Weight lifting) 4-5 times a week. Ensure you eat protein within 30 mins of working out.";
        } else {
            targetCalories = tdee;
            adviceText = "Maintain a mix of cardiovascular health (running/swimming) and functional strength training to keep your joints healthy.";
        }

        targetCalories = Math.round(targetCalories);

        // 4. Protein & Water
        let proteinMultiplier = (goal === 'gain' || goal === 'loss') ? 1.2 : 0.8; 
        // Note: Higher protein for loss to preserve muscle, higher for gain to build.
        let protein = Math.round(weightKg * proteinMultiplier);
        let water = (weightKg / 15).toFixed(1); // Water: Weight (kg) / 30 = Liters/Day

        // --- Update UI ---
        document.getElementById('res-name-display').innerText = name;
        document.getElementById('res-bmi').innerText = bmi;
        document.getElementById('res-category').innerText = bmiCategory;
        
        // Color code BMI
        const bmiEl = document.getElementById('res-bmi');
        if(bmiCategory === 'Healthy Weight') bmiEl.style.color = '#2ecc71';
        else if(bmiCategory === 'Obese') bmiEl.style.color = '#e74c3c';
        else bmiEl.style.color = '#f39c12';

        document.getElementById('res-calories').innerText = targetCalories;
        document.getElementById('res-protein').innerText = protein;
        document.getElementById('res-water').innerText = water;
        document.getElementById('res-activity-rec').innerText = adviceText;

        // Generate Meal Plan
        generateMealPlan(targetCalories, goal, dietPreference); 

        // Switch Screen
        switchView('result');
    }

    // 3. Meal Plan Generator Logic
    function generateMealPlan(calories, goal, dietPreference) {
        const container = document.getElementById('meal-plan-output');
        
        // Splits: Breakfast 25%, Lunch 35%, Snack 10%, Dinner 30%
        const b_cal = Math.round(calories * 0.25);
        const l_cal = Math.round(calories * 0.35);
        const s_cal = Math.round(calories * 0.10);
        const d_cal = Math.round(calories * 0.30);

        let breakfastFood, lunchFood, dinnerFood;

        if (dietPreference === 'non-vegetarian') {
            breakfastFood = (goal === 'loss') ? "Egg white omelet with spinach, mushrooms, and 1 slice whole wheat toast." : "Oatmeal with berries, scoop of whey protein, and almonds.";
            lunchFood = (goal === 'gain') ? "Large portion of pasta with lean ground beef, tomato sauce, and cheese." : "Grilled chicken breast, quinoa bowl, and mixed roasted vegetables.";
            dinnerFood = (goal === 'loss') ? "Large mixed green salad with grilled turkey breast and olive oil dressing." : "Baked Salmon with asparagus and half a sweet potato.";
        } else if (dietPreference === 'vegetarian') {
            breakfastFood = (goal === 'loss') ? "Low-fat cottage cheese with sliced tomatoes and black pepper." : "Oatmeal with berries, vegetarian protein powder, and mixed nuts.";
            lunchFood = (goal === 'gain') ? "Lentil stew with whole-grain bread and Greek yogurt." : "Tofu scramble with bell peppers and a side of brown rice.";
            dinnerFood = (goal === 'loss') ? "Large portion of paneer tikka (baked, not fried) with mint chutney." : "Baked eggplant parmesan (reduced cheese) and a side salad.";
        } else if (dietPreference === 'vegan') {
            breakfastFood = (goal === 'loss') ? "Tofu scramble with turmeric, nutritional yeast, and vegetables." : "Oatmeal with flax seeds, banana, and a plant-based protein shake.";
            lunchFood = (goal === 'gain') ? "Black bean burgers on whole-wheat buns with avocado." : "Large quinoa and chickpea salad with vinaigrette dressing.";
            dinnerFood = (goal === 'loss') ? "Cauliflower steak with pesto and roasted sweet potatoes." : "Taco bowl with lentils, corn, salsa, and brown rice.";
        }
        
        // Adjusting snack based on diet preference
        let snackDesc = "Greek yogurt (Non-Veg/Veg) or an apple and peanut butter (Vegan).";
        if (dietPreference === 'vegan') {
             snackDesc = "An apple, peanut butter, and a small handful of cashews.";
        } else if (dietPreference === 'vegetarian') {
            snackDesc = "Greek yogurt, an apple, or a handful of mixed nuts.";
        } else {
            snackDesc = "Protein bar, or an apple and small handful of mixed nuts.";
        }

        const html = `
            <div class="meal-row">
                <div class="meal-time">BREAKFAST (25%)</div>
                <div class="meal-desc">${breakfastFood}</div>
                <div class="meal-cal">~${b_cal} kcal</div>
            </div>
            <div class="meal-row">
                <div class="meal-time">LUNCH (35%)</div>
                <div class="meal-desc">${lunchFood}</div>
                <div class="meal-cal">~${l_cal} kcal</div>
            </div>
             <div class="meal-row">
                <div class="meal-time">SNACK (10%)</div>
                <div class="meal-desc">${snackDesc}</div>
                <div class="meal-cal">~${s_cal} kcal</div>
            </div>
            <div class="meal-row">
                <div class="meal-time">DINNER (30%)</div>
                <div class="meal-desc">${dinnerFood}</div>
                <div class="meal-cal">~${d_cal} kcal</div>
            </div>
            <div style="margin-top:15px; text-align:right; font-size:0.85rem; color:#7f8c8d;">
                *Macros: Aim for approx <strong>${Math.round(calories*0.45/4)}g Carbs</strong> | <strong>${Math.round(calories*0.25/9)}g Fat</strong>
            </div>
        `;

        container.innerHTML = html;
    }
</script>

</body>
</html>